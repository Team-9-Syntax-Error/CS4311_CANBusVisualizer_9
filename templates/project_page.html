<html>
   <head>
      <title>Project Page</title>
   </head>
   <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='Project_Page.css')}}">
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
   <body>

      <div class="navbar">

         <!-- DROPDOWN FOR FILE -->
         <div class="dropdown">
           <button class="dropbtn">File 
             <i class="fa fa-caret-down"></i>
           </button>
           <div class="dropdown-content">
             <a href="#">Save Project</a>
             <a href="#">Open Saved Packets</a>
             <a href="edit_config">Edit Configurations</a>
           </div>
         </div> 

         <!-- DROPDOWN FOR VIEW -->
         <div class="dropdown">
            <button class="dropbtn">View 
              <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
              <a href="#">Filter Packets</a>
              <a href="#">Sort Packets</a>
            </div>
          </div> 

          <!-- DROPDOWN FOR PACKETS -->
          <div class="dropdown">
            <button class="dropbtn">Packets 
              <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
              <a id = "edit" onclick="myfunction_clickevent_edit(); openForm();">Replay Packet</a>

              <!--
              <div class="form-popup" id="myForm">
                <form action="/project_page.html" class="form-container">
                  <h2>Edit Packet</h2>

                  <label for="name"><b>Name:</b></label>
                  <input type="text" placeholder="Name" name="name" required>

                  <label for="id"><b>ID:</b></label>
                  <input type="text" placeholder="ID" name="id" required>

                  <label for="data"><b>Data:</b></label>
                  <input type="text" placeholder="Data" name="data" required>

                  <button type="submit" class="btn">Accept</button>
                  <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
                </form>
              </div>
              -->

              <a id = "save" onclick="myfunction_clickevent_save()">Save Packet</a>
              <a id = "annotate" onclick="myfunction_clickevent_annotate()">Annotate Packet</a>
            </div>

          </div> 
        </div>

      <!-- CONTAINER FOR PACKET TABLE -->
      <!-- <button id = "replay" onclick="myfunction_clickevent_replay()">Replay Packet</button> -->
      <div class="container_table" id="box">

<style> th{ 
        color:#fff;
        }
</style>

<div class="row">
  <div class="col">
    <div class="card card-body">
      <input id="search-input" class="form-control" type="text">
    </div>
  </div>
</div>

<table class="table table-striped">
    <tr  class="bg-info">
        <th data-column="timestamp" data-order='desc'>Timestamp &#9650</th>
        <th data-column="id" data-order='desc'>ID &#9650</th>
        <th data-column="s" data-order='desc'>S &#9650</th>
        <th data-column="dl" data-order='desc'>DL &#9650</th>
        <th data-column="channel" data-order='desc'>Channel &#9650</th>
        <th data-column="annotate" data-order='desc'>Annotate &#9650</th>
    </tr>

    <tbody id="myTable">
        
    </tbody>
</table>

      </div>

<script>
//Hardcode data
	var myArray = [
	    {"timestamp": "1668656928.407125", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Front lights"},
      {"timestamp": "1668656928.443125", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Oil"},
      {"timestamp": "1668656928.403425", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Door"},
      {"timestamp": "1668656928.4025725", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Alarm"},
      {"timestamp": "1668656928.4072345", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Back lights"},
      {"timestamp": "1668656928.405435", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Front lights"},
      {"timestamp": "16452643.443125", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Transmision"},
      {"timestamp": "658656928.403425", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Door"},
      {"timestamp": "78578656928.4025725", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Alarm"},
      {"timestamp": "5787856928.4072345", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "-"},
      {"timestamp": "1668656928.4072345", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Back lights"},
      {"timestamp": "1668656928.405435", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Front lights"},
      {"timestamp": "16452643.443125", "id": "01f0","s": "Tx","dl": "94 0c 80 00 00 00 00","channel": "vcan0","annotate": "Transmision"}
	]

	$('th').on('click', function(){
		var column = $(this).data('column')
		var order = $(this).data('order')
		var text = $(this).html()
		text = text.substring(0, text.length - 1)

		if(order == 'desc'){
			$(this).data('order', "asc")
			myArray = myArray.sort((a,b) => a[column] > b[column] ? 1 : -1)
			text += '&#9660'
		}else{
			$(this).data('order', "desc")
			myArray = myArray.sort((a,b) => a[column] < b[column] ? 1 : -1)
			text += '&#9650'
      }

		$(this).html(text)
		buildTable(myArray)
	})
	
  $('#search-input').on('keyup', function(){
    var value = $(this).val()
    var data = searchTable(value, myArray)
    buildTable(data)
  })

	buildTable(myArray)


  function searchTable(value, data){
    var filteredData = []

    for (var i = 0; i< data.length; i++){
      value = value.toLowerCase()
      var annotate = data[i].annotate.toLowerCase()

      if (annotate.includes(value)){ 
        filteredData.push(data[i])
      }

    }
    
    return filteredData
  }

	function buildTable(data){
		var table = document.getElementById('myTable')
    table.innerHTML = ''
		for (var i = 0; i < data.length; i++){
			var row = `<tr>
							<td>${data[i].timestamp}</td>
							<td>${data[i].id}</td>
							<td>${data[i].s}</td>
              <td>${data[i].tx}</td>
							<td>${data[i].channel}</td>
							<td>${data[i].annotate}</td>
					  </tr>`
			table.innerHTML += row

		}
	}

</script>

      <!-- CONTAINER FOR MAP -->
      <div class="container_map" id="box2">
        <body onload="init()">
          <div id="myDiagramDiv" class = "myDiagram"></div>
          </body>
      </div> 

     

      <div w3-include-html="graph.html"></div>


      <element onload="myfunction_onload">
      <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
      <button type="submit" class= "button2" onclick='myfunction_clickevent_send()'>Send</button>
      
      <script>
        function myfunction_onload(){
            $.ajax({
                url: "main.py",
                 context: document.body
                })
            }
        </script>
    
    <!-- Script to refresh table when send is clicked -->
    <script>
        function myfunction_clickevent_send(){
          $('#custom_table').load(document.URL +  ' #custom_table');
            $.ajax({
                url:"/send",
                context: document.body});}
    </script>


<script>
  function myfunction_clickevent_edit(){
      $.ajax({
          url:"/edit",
          context: document.body});  
          }
</script>

<script>
function openForm() {
  document.getElementById("myForm").style.display = "block";
}

function closeForm() {
  document.getElementById("myForm").style.display = "none";
  }
</script>

<script>
  function myfunction_clickevent_replay(){
      $.ajax({
          url:"/replay",
          context: document.body});}
</script>
<script>
  function myfunction_clickevent_save(){
      $.ajax({
          url:"/save",
          context: document.body});}
</script>
<script>
  function myfunction_clickevent_annotate(){
      $.ajax({
          url:"/annotate",
          context: document.body});}

</script>



<script src="https://unpkg.com/gojs/release/go-debug.js"></script>

        <script>
    
            function init(){
                var $ = go.GraphObject.make;
                myDiagram = $(go.Diagram, "myDiagramDiv");
                myDiagram.nodeTemplate =
                new go.Node("Horizontal",
                    // the entire node will have a light-blue background
                    { background: "#44CCFF" })
                    .add(new go.Picture(
                        // Pictures should normally have an explicit width and height.
                        // This picture has a red background, only visible when there is no source set
                        // or when the image is partially transparent.
                        { margin: 10, width: 50, height: 50, background: "black" })
                        // Picture.source is data bound to the "source" attribute of the model data
                        .bind("source"))
                    .add(new go.TextBlock(
                        "Default Text",  // the initial value for TextBlock.text
                        // some room around the text, a larger font, and a white stroke:
                        { margin: 12, stroke: "white", font: "bold 16px sans-serif" })
                        // TextBlock.text is data bound to the "name" property of the model data
                        .bind("text", "name"));
                        
                        myDiagram.linkTemplate =
                        new go.Link(
                            // default routing is go.Link.Normal
                            // default corner is 0
                            { routing: go.Link.Orthogonal, corner: 5 })
                            // the link path, a Shape
                            .add(new go.Shape({ strokeWidth: 3, stroke: "#555" }))
                            // if we wanted an arrowhead we would also add another Shape with toArrow defined:
                            //.add(new go.Shape({  toArrow: "Standard", stroke: null  }))
                        // it's best to declare all templates before assigning the model
                        myDiagram.model = new go.TreeModel(
                        [   {key: "0",               name: "Bus Termination"},
                            { key: "1", parent:"0",  name: "Airbag"},
                            { key: "2", parent:"7",  name: "brake"},
                            { key: "3", parent: "0", name: "engine"},
                            { key: "4", parent: "7", name: "lights"},
                            { key: "5", parent: "0", name: "oil"},
                            { key: "6", parent: "7", name: "transmission"},
                            { key: "7", parent: "0", name: "Bus Termination"}
                        ]);
            }
        </script>




</body>
</html>